<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ESA Client</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="hero">
    <div class="brand">
      <div class="logo">ESA</div>
      <div class="tagline">Excel Server Application</div>
    </div>
    <div class="session">
      <div id="session-info" class="session-user-info hidden">
        <span id="session-user"></span>
        <button id="logout-btn" type="button" class="btn-small">Logout</button>
      </div>
      <button id="back-to-login" type="button" class="ghost">Login</button>
    </div>
  </header>

  <main>
    <div class="tabs" id="tabs">
      <button class="tab-btn active" data-tab-btn="apps">Applications</button>
      <button class="tab-btn" data-tab-btn="developer">Developer</button>
      <button class="tab-btn" data-tab-btn="admin">Admin</button>
    </div>

    <section class="card" id="apps-panel">
      <div class="panel-head">
        <h2>Applications</h2>
        <div class="search-container">
          <input type="search" id="app-search" placeholder="Search apps by name or group..." />
        </div>
      </div>
      <div id="apps-list" class="apps-store-grid"></div>
    </section>

    <div id="app-overlay" class="app-overlay hidden" aria-hidden="true">
      <div class="app-overlay-content">
        <div class="app-overlay-header">
          <h3 id="app-workspace-title">Select an application</h3>
          <div class="workspace-actions">
            <button type="button" id="app-refresh" class="ghost" disabled>Refresh Data</button>
            <button type="button" id="app-exit" class="ghost" disabled>Close App</button>
          </div>
        </div>
        <div id="app-ui-body" class="app-overlay-body">
          <div class="hint" id="app-ui-empty">Choose an application to load its interface.</div>
          <form id="app-ui-form" class="hidden"></form>
        </div>
        <div class="app-overlay-footer">
          <div class="hint" id="app-workspace-desc">Launch an application to render its authored UI.</div>
        </div>
      </div>
    </div>

    <section class="card tab-content" id="create-panel" data-tab="developer" aria-label="Developer">
      <div class="panel-head">
        <h2>Developer</h2>
        <span class="pill" id="developer-pill">Developer-only</span>
      </div>
      <div class="panel-head" style="margin-top:4px;">
        <h3 style="margin:0;">Your Applications</h3>
        <button id="dev-create-new" type="button">Create New</button>
      </div>
      <div id="developer-list" class="grid"></div>
      <p id="create-hint" class="hint">Visible only when your role is Developer or Admin. If the server does not expose roles, you can force-enable once logged in.</p>
    </section>

    <section class="card tab-content" id="admin-panel" data-tab="admin" aria-label="Admin actions">
      <div class="panel-head">
        <h2>Admin</h2>
        <span class="pill warning">Admin-only</span>
      </div>
      <div id="admin-warning" class="hint">Sign in as an administrator to manage users.</div>
      <div id="users-area" class="hidden">
        <h3>Users</h3>
        <table id="users-table">
          <thead><tr><th>Name</th><th>Groups</th><th>Role</th></tr></thead>
          <tbody></tbody>
        </table>
        <h3>Create / Update User</h3>
        <form id="user-form">
          <div class="two-col">
            <label>Username <input name="username" required></label>
            <label>Password <input name="password" required></label>
          </div>
          <div class="two-col">
            <label>Groups (comma) <input name="groups" placeholder="team,project"></label>
            <label>Role
              <select name="role">
                <option value="user">User</option>
                <option value="developer">Developer</option>
              </select>
            </label>
          </div>
          <div class="actions"><button type="submit">Save User</button></div>
        </form>
      </div>
    </section>
  </main>

  <div id="dev-modal" class="modal hidden" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="dev-modal-title">
      <div class="modal-head">
        <h3 id="dev-modal-title">Create / Update Application</h3>
        <button type="button" id="dev-modal-close" class="ghost icon-btn" aria-label="Close dialog">&#10005;</button>
      </div>
      <div class="hint" id="dev-form-mode">Mode: Create new</div>
      <form id="create-form">
        <div class="two-col">
          <label>Name <input name="name" required></label>
          <label>Access Group <input name="access_group" placeholder="optional"></label>
        </div>
        <label>Description <input name="description"></label>
        <div class="row">
          <label class="checkbox"><input type="checkbox" name="public"> Public (allow everyone)</label>
          <label class="file">
            <span>Select .xlsx file</span>
            <input type="file" name="file" accept=".xlsx" required>
          </label>
        </div>
        <label class="file image-upload">
          <span>Optional preview image (PNG/JPG)</span>
          <input type="file" name="image" accept="image/*">
        </label>
        <div class="actions">
          <button type="submit">Save</button>
          <button type="button" id="dev-modal-cancel" class="ghost">Cancel</button>
          <button type="button" id="developer-override" class="ghost">Force Developer UI</button>
        </div>
      </form>
    </div>
  </div>

  <div id="ui-builder-modal" class="modal hidden" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="dialog" aria-modal="true" aria-labelledby="ui-builder-title">
      <div class="modal-head">
        <h3 id="ui-builder-title">Application UI Builder</h3>
        <button type="button" id="ui-builder-close" class="ghost icon-btn" aria-label="Close dialog">&#10005;</button>
      </div>
      <p class="hint">Map Excel cell references to fields and displays. Save to publish your experience.</p>
      <div class="builder-shell">
        <div class="builder-list">
          <div class="builder-list-head">
            <h4>Components</h4>
            <span id="builder-app-label" class="pill">No app</span>
          </div>
          <div id="builder-components" class="builder-components"></div>
          <div id="builder-empty" class="hint">No components yet. Add one using the form.</div>
        </div>
        <form id="builder-form" class="builder-form">
          <input type="hidden" name="component_id" id="builder-component-id">
          <label>Label
            <input name="label" id="builder-label" required>
          </label>
          <div class="two-col">
            <label>Sheet
              <select name="sheet" id="builder-sheet" required>
                <option value="">Loading sheetsâ€¦</option>
              </select>
            </label>
            <label>Cell / Range <input name="cell" id="builder-cell" placeholder="A1" required></label>
          </div>
          <div class="two-col">
            <label>Mode
              <select name="mode" id="builder-mode">
                <option value="display">Display (read-only)</option>
                <option value="input">Input (two-way)</option>
              </select>
            </label>
            <label>Input Type
              <select name="inputType" id="builder-input-type">
                <option value="text">Text</option>
                <option value="number">Number</option>
              </select>
            </label>
          </div>
          <div class="actions">
            <button type="submit" id="builder-save-component">Save Component</button>
            <button type="button" id="builder-reset" class="ghost">Clear Selection</button>
          </div>
        </form>
      </div>
      <div class="actions builder-actions">
        <button type="button" id="builder-save-layout">Save Layout</button>
        <button type="button" id="ui-builder-cancel" class="ghost">Close</button>
      </div>
    </div>
  </div>

  <div id="ui-preview-modal" class="modal hidden" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="ui-preview-title">
      <div class="modal-head">
        <h3 id="ui-preview-title">UI Preview</h3>
        <button type="button" id="ui-preview-close" class="ghost icon-btn" aria-label="Close preview">&#10005;</button>
      </div>
      <p class="hint" id="ui-preview-subtitle">Select an app to preview its interface.</p>
      <div class="workspace-body">
        <div id="ui-preview-empty" class="hint">No components defined yet. Add fields in the builder to see them here.</div>
        <div id="ui-preview-content" class="app-ui-preview"></div>
      </div>
      <div class="actions">
        <button type="button" id="ui-preview-close-btn" class="ghost">Close</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast hidden"></div>
  <script src="app.js"></script>
</body>
</html>
